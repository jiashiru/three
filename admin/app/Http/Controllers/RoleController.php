<?phpnamespace App\Http\Controllers;use App\Model\Role;use App\Model\Node;use Illuminate\Http\Request;use DB;class RoleController extends CommonController{    //角色展示    public function show()    {        $roleList = Role::all()->toArray();        return view('role.show', ['roleList' => $roleList]);    }    //角色添加    public function add(Request $request)    {        if ($request->isMethod('POST')) {            $this->validate($request, [                'role' => 'required',            ],[                'required' => ':attribute 为必填项',            ],[                'role' => '姓名',            ]);            $role = $request->input('role');            $admin = new Role();            $admin->role_name = $role;            if ($admin->save()) {                return redirect('roleShow')->with('success', '添加成功');            } else {                return redirect('roleAdd')->with('error', '添加失败');            }        }        return view('role.add');    }    //角色赋权    public function edit(Request $request)    {        $data = Node::all()->toArray();        $node = new Node();        $nodeList = $node->nodeData($data, $parent_id = 0, $level = 0);        $role_id = $request->get('id');        $role = Role::with('nodes')->take(20)->where(['role_id' => $role_id])->get()->toArray();        if ($request->isMethod('POST')) {            $node_id = $request->input();            DB::table('role_node')->where('role_id', '=', $node_id['role_id'])->delete();            foreach ($node_id['node_id'] as $val) {                $bool = DB::table('role_node')->insert(['role_id' => $node_id['role_id'], 'node_id' => $val]);            }            if ($bool) {                return redirect('roleShow')->with('success', '赋权成功');            } else {                return redirect('roleEdit')->with('error', '赋权失败');            }        }        return view('role.edit', ['role' => $role[0], 'nodeList' => $nodeList]);    }    //角色删除    public function delete(Request $request)    {        $role_id = $request->get('id');        $bool = Role::where('role_id', '=', $role_id)->delete();        if ($bool) {            $bools = DB::table('role_node')->where('role_id', '=', $role_id)->delete();            if ($bools) {                return redirect('roleShow')->with('success', '删除成功');            } else {                return redirect('roleShow')->with('error', '删除失败');            }        } else {            return redirect('roleShow--')->with('error', '删除失败');        }    }}
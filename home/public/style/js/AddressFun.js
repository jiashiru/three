var CBLPageFun=null;$(function(){var a="http://skin.1yyg.net";var b=function(){var f=$("#div_form");var m=$("#a_add");var g=$("#ul_addresslist");var c=function(o){var n="";n+='<div class="shi-address-box">';n+='<h2 class="gray3">'+(o?"修改":"添加")+"收货地址</h2>";n+="<ul>";n+="<li>";n+="<label>收<i>货</i>人：</label>";n+='<input id="txtConsignee" type="text" maxlength="5" /><em class="f-tran">*</em>';n+='<p class="orange"></p><cite class="gray9"></cite>';n+="</li>";n+="<li>";n+='<label>手机号码：</label><input id="txtMobile" type="text" maxlength="11" /><em class="f-tran">*</em>';n+='<p class="orange"><b class="u-personal"></b></p>';n+="</li>";n+='<li class="select-list">';n+="<label>所在地区：</label>";n+='<div class="fl clrfix" id="div_area">';n+='<span class="u-select-con" id="selProvinceID">';n+='<a href="javascript:;" class="gray6">---请选择---<s class="u-personal"></s>';n+="</a>";n+="</span>";n+='<span class="u-select-con" id="selCityID">';n+='<a href="javascript:;" class="gray6">---请选择---<s class="u-personal"></s>';n+="</a>";n+="</span>";n+='<span class="u-select-con" id="selCountyID">';n+='<a href="javascript:;" class="gray6">---请选择---<s class="u-personal"></s>';n+="</a>";n+="</span>";n+='<span class="u-select-con" id="selAddressID" style="display: none;">';n+='<a href="javascript:;" class="gray6">---请选择---<s class="u-personal"></s>';n+="</a>";n+="</span>";n+="</div>";n+='<em class="f-tran">*</em>';n+='<p class="orange"></p>';n+="</li>";n+='<li class="z-address">';n+='<label>详细地址：</label><input id="txtAddress" type="text" maxlength="30" />';n+='<em class="f-tran">*</em>';n+='<p class="orange"></p>';n+='<cite class="gray9">无需重复填写所在地区</cite>';n+="</li>";n+="<li>";n+="<label>邮政编码：</label>";n+='<input id="txtPostCode" type="text" maxlength="6" /><p class="orange"></p>';n+="</li>";n+="<li>";n+='<label>固定电话：</label><input id="txtTel" type="text" maxlength="20" /><p class="orange"></p></li>';if(!o&&e<1){n+='<li class="set-default z-click">'}else{n+='<li class="set-default">'}n+='<a href="javascript:;" id="a_default" class="gray9"><i><s class="u-personal"></s></i>设为默认地址</a>';n+="</li>";n+='<li class="z-save-btn">';n+='<a id="btnSave" href="javascript:;" class="save">保存</a>';n+='<a id="btnCancel" href="javascript:;" class="close">取消</a>';n+="</li>";n+="</ul>";n+="</div>";return n};var j=function(v){var r=v>0?true:false;f.html(c(r)).show();m.hide();var F=$("#div_area",f);var D=$("#txtAddress",f);var N=$("#txtPostCode",f);var Y=$("#txtConsignee",f);var q=$("#txtTel",f);var C=$("#txtMobile",f);var X=$("#a_default",f);var J=$("#selProvinceID",f);var M=$("#selCityID",f);var W=$("#selCountyID",f);var B=$("#selAddressID",f);var Q=$("#btnSave",f);var Z=$("#btnCancel",f);var V="#333333",t="#bbbbbb";Z.bind("click",function(){f.hide();m.show()});var I="",u="",aa="",O="",z="",P="",H="",y="",E="",S=0,U=0;if(r){if(l){return}l=true;var T=function(ac){F.initAreaFun({AAreaID:ac.AID,BAreaID:ac.BID,CAreaID:ac.CID,DAreaID:ac.DID,AAreaName:ac.AName,BAreaName:ac.BName,CAreaName:ac.CName,DAreaName:ac.DName,CountyClickCallBack:function(ad){if(ad!="000000"){N.val(ad).css("color",V)}}});D.val(ac.Address);N.val(ac.Zip);Y.val(ac.Name);q.val(ac.Tel);C.val(ac.Mobile);if(ac.Default=="1"){X.parent().addClass("z-click")}else{X.bind("click",function(){var ad=$(this).parent();if(ad.hasClass("z-click")){ad.removeClass("z-click")}else{ad.addClass("z-click")}})}if(ac.Address!=""){D.css("color",V)}if(ac.Zip!=""){N.css("color",V)}if(ac.Name!=""){Y.css("color",V)}if(ac.Tel!=""){q.css("color",V)}if(ac.Mobile!=""){C.css("color",V)}l=false};GetJPData("","getMemberContactInfo","contactID="+v,T)}else{F.initAreaFun({CountyClickCallBack:function(ac){if(ac!="000000"){N.val(ac).css("color",V)}}})}var w=function(ad){var ac=/^1\d{10}$/;return ac.test(ad)};var A=function(ad){var ac=/^\d{6}$/;return ac.test(ad)};var p=function(ad){var ac=/^(\d{3}-|\d{4}-)?(\d{8}|\d{7})?$/;return ac.test(ad)};var s=function(ad){if(ad.length<2||ad.length>5){return false}var ac=/^[\u4E00-\u9FA5]+$/;return ac.test(ad)};var x=function(ac){var ad=["老","大","小","阿","啊"];var ae=["先生","小姐","女士"];if($.inArray(ac.substring(0,1),ad)>-1||ac.indexOf(ae[0])>-1||ac.indexOf(ae[1])>-1||ac.indexOf(ae[2])>-1){return false}return true};var o=function(){S=parseInt(W.attr("AreaID"));I=J.attr("AreaName");u=M.attr("AreaName");aa=W.attr("AreaName");if(isNaN(S)||S==0||(I==""||typeof(I)=="undefined")||(u==""||typeof(u)=="undefined")||(aa==""||typeof(aa)=="undefined")){F.next().hide();F.next().next().html('<b class="u-personal"></b>必填').show();return false}if(B.children("div.select-state").find("a").length>0){U=parseInt(B.attr("AreaID"));O=B.attr("AreaName");if(isNaN(U)||U==0||(O==""||typeof(O)=="undefined")){F.next().hide();F.next().next().html('<b class="u-personal"></b>必填').show();return false}}F.next().show();F.next().next().hide();return true};var L=function(ad){var ac=/^[a-zA-Z0-9#_\(\)\-\s\u4e00-\u9fa5]{3,30}$/;return ac.test(ad)};var ab=function(){z=D.val().trim();if(z==""){D.next().next().html('<b class="u-personal"></b>必填').show();D.next().next().next().hide();D.parent().addClass("errow-prompt");return false}else{if(!L(z)){D.next().next().show().html('<b class="u-personal"></b>3-30个字符，不包含特殊符号').show();D.next().next().next().hide();D.parent().addClass("errow-prompt");return false}}D.parent().removeClass("errow-prompt");D.next().next().hide();D.next().next().next().show();return true};var R=function(){P=N.val().trim();if(P!=""&&!A(P)){N.next().html("请填写正确的邮政编码").show();N.parent().addClass("errow-prompt");return false}N.parent().removeClass("errow-prompt");N.next().hide();return true};var n=function(){H=Y.val().trim().replace(/\s/g,"");if(H==""){Y.next().next().html('<b class="u-personal"></b>必填').show().next().show();Y.parent().addClass("errow-prompt");return false}else{if(!s(H)){Y.next().next().html('<b class="u-personal"></b>真实姓名由2到5个中文汉字组成，不包含英文、数字、符号').show().next().hide();Y.parent().addClass("errow-prompt");return false}else{if(!x(H)){Y.next().next().html('<b class="u-personal"></b>请填写真实有效的姓名，否则将无法进行配送').show().next().hide();Y.parent().addClass("errow-prompt");return false}}}Y.parent().removeClass("errow-prompt");Y.next().next().hide();return true};var K=function(){y=q.val().trim();if(y!=""&&!p(y)){q.next().html("请填写真实有效的固定电话").show();q.parent().addClass("errow-prompt");return false}q.parent().removeClass("errow-prompt");q.next().hide();return true};var G=function(){E=C.val().trim();if(E==""){C.next().next().html('<b class="u-personal"></b>必填').show();C.parent().addClass("errow-prompt");return false}else{if(E!=""&&!w(E)){C.next().next().html('<b class="u-personal"></b>请填写真实有效的手机号码').show();C.parent().addClass("errow-prompt");return false}}C.parent().removeClass("errow-prompt");C.next().next().hide();return true};D.focus(function(){$(this).parent().addClass("z-focus")}).blur(function(){$(this).parent().removeClass("z-focus")}).keydown(function(){$(this).css("color",V)});N.focus(function(){$(this).parent().addClass("z-focus")}).blur(function(){$(this).parent().removeClass("z-focus")}).keydown(function(){$(this).css("color",V)});Y.focus(function(){$(this).parent().addClass("z-focus")}).blur(function(){$(this).parent().removeClass("z-focus")}).keydown(function(){$(this).css("color",V)});q.focus(function(){$(this).parent().addClass("z-focus")}).blur(function(){$(this).parent().removeClass("z-focus")}).keydown(function(){$(this).css("color",V)});C.focus(function(){$(this).parent().addClass("z-focus")}).blur(function(){$(this).parent().removeClass("z-focus")}).keydown(function(){$(this).css("color",V)});if(!r){X.bind("click",function(){if(e<1){return}var ac=$(this).parent();if(ac.hasClass("z-click")){ac.removeClass("z-click")}else{ac.addClass("z-click")}})}Q.bind("click",function(){var ah=o();var ag=ab();var af=R();var ae=n();var ad=K();var ac=G();var ai=X.parent().hasClass("z-click");if(ah&&ag&&af&&ae&&ad&&ac){var ak=function(){var al="";al+="contactID="+v;al+="&areaCID="+S;al+="&areaDID="+U;al+="&shipAddress="+encodeURI(z);al+="&shipZip="+P;al+="&shipName="+encodeURI(H);al+="&shipMobile="+E;al+="&shipTel="+encodeURI(y);al+="&default="+(ai?1:0);return al};var aj=function(al){var am=al.code;if(am==0){OKDialog(r?"保存成功！":"添加成功！",160,60,function(){location.reload()})}else{FailDialog(al.str,250,60)}};GetJPData("","saveMemberContact",ak(),aj)}})};var d=false,l=false,k=false,i=false;var e=0;var h=function(){g.html('<div class="loading-2015"><em></em></div>');if(d){return}d=true;var n=function(o){e=0;var q="";$(o).each(function(){if(typeof(this.Name)=="undefined"){return false}else{e++;var u=this.Mobile==""?this.Tel:this.Mobile;q+="<li>";q+='<span class="u-name">'+this.Name+"</span>";q+='<span class="u-tel">'+u+"</span>";q+='<span class="u-address">'+this.AName+" "+this.BName+" "+this.CName+" "+this.DName+" "+this.Address+"</span>";q+='<span class="u-code">'+this.Zip+"</span>";q+='<span class="u-option">';q+='<a href="javascript:;" name="update" id="'+this.ID+'" class="op-tail">修改</a>';if(this.Default!=1){q+='<a href="javascript:;" name="delete" id="'+this.ID+'" class="op-tail">删除</a>'}q+="</span>";q+='<span class="u-set">';if(this.Default==1){q+='<b class="is-normal">默认地址</b>'}else{q+='<b class="set-normal" id="'+this.ID+'">设为默认地址</b>'}q+="</span>";q+="</li>"}});if(e>0){var t=$(q);t.find("a[name='update']").bind("click",function(){var u=parseInt($(this).attr("id"));if(u>0){j(u)}});t.find("a[name='delete']").bind("click",function(){var v=parseInt($(this).attr("id"));if(v>0){if(e<2){FailDialog("对不起，您至少要保留一个收货地址",270)}else{var u=function(){if(k){return}k=true;GetJPData("","deleteMemberContact","contactID="+v,function(w){if(w!=null&&w.code==0){FailDialog("删除成功！",160);location.reload()}else{if(w!=null&&w.code==2){location.reload()}else{FailDialog(w.str,270)}}k=false})};ShowConfirm("您确定要删除此配送地址吗？",u)}}});t.find("b.set-normal").bind("click",function(){var u=parseInt($(this).attr("id"));if(u>0){if(i){return}i=true;GetJPData("","setMemberContactDefault","contactID="+u,function(v){if(v!=null&&v.code==0){OKDialog("设置成功！",160,60,function(){location.reload()})}else{if(v!=null&&v.code==2){location.reload()}else{FailDialog(v.str,300)}}i=false})}});g.html(t);var p='<a href="javascrit:;" class="new-add-btn">添加新地址</a>';var s='<p class="add-tips">最多可添加4条收货地址</p>';if(e<4){g.append(p+s)}else{if(e==4){g.append(s)}}}else{g.empty();var r='<div class="null-retips-wrapper kt-icon"><img src="http://skin.1yyg.net/images/kt-dz.jpg"><p class="gray">主银，您还没有添加收货地址哦~</p><a href="javascript:;" class="z-kt-btn">添加新地址</a></div>';g.parent().append(r)}d=false;m.show()};GetJPData("","getMemberContactList","",n)};h();$(document).on("click",".z-kt-btn,.new-add-btn",function(){if(e<4){j(0)}else{FailDialog("最多只可添加4条收货地址哦！",300)}return false})};Base.getScript(a+"/Member/JS/SelectAreaControl.js?date=20150210",b)});
var _Ptn=/^\d+$/;var PagePOPLoginOK=null;var _IsLoadLoginJS=false;var _UserBalance=0;var _IsLimitBuy=false;var _LimitBuyNum=0;var _BuyedNum=0;var _GotoPayPage=false;var _IsLogined=true;var _IsLoadPlJs=false;var _IsBuySubmiting=false;var buyFun=null;var $cartFun=new $CartComm();$.fn.GoodsItemFun=function(){var a=$(this);var b=a.attr("goodsID");a.hover(function(){var f=$(this);var c=location.href.indexOf("/limitBuy/")>-1;if(c){f.addClass("products-hover")}else{if(parseInt(f.attr("idx"))%4==0){f.removeClass("soon-list4").addClass("soon-list-hover2")}f.addClass("soon-list-hover")}var d=f.find("div.f-add-attention");if(d.html()==""){GetJPData("http://api.1yyg.com","checkCollectGoods","goodsID="+b,function(i){var h=function(){d.html('<span>关注</span><a href="javascript:;" class="ng-box-bg transparent-png"></a>');d.hover(function(){$(this).addClass("attention-hover")},function(){$(this).removeClass("attention-hover")}).find("a").click(function(){if(d.attr("isClt")=="1"){return}var j=function(){d.attr("isClt","1");var k=function(l){if(l.code==0){$("#divRTColect").attr("isChanged","1");d.addClass("attention-ygz").html('<span>已关注</span><a href="javascript:;" class="ng-box-bg transparent-png"></a>');g()}else{if(l.code==1){if(l.num==-1){location.reload()}else{if(l.num==-2){d.addClass("attention-ygz").html('<span>已关注</span><a href="javascript:;" class="ng-box-bg transparent-png"></a>');g()}}}else{location.reload()}}d.attr("isClt","0")};GetJPData("http://api.1yyg.com","addCollectGoods","goodsID="+b,k)};if(!_IsLogined){loginFun(j)}else{j()}return false})};var g=function(){d.find("a").unbind("click").click(function(){if(d.attr("isClt")=="1"){return}d.attr("isClt","1").removeClass("attention-ygz").html('<span>已取消</span><a href="javascript:;" class="ng-box-bg transparent-png"></a>');var j=function(k){if(k.code==0){$("#divRTColect").attr("isChanged","1");setTimeout(h,2000)}d.attr("isClt","0")};GetJPData("http://api.1yyg.com","delCollectGoods","goodsID="+b,j);return false})};if(i.code==0){d.addClass("attention-ygz").hover(function(){$(this).addClass("attention-hover")},function(){$(this).removeClass("attention-hover")}).html('<span>已关注</span><a href="javascript:;" class="ng-box-bg transparent-png"></a>');if(f.hasClass("soon-list-hover")){d.show()}g()}else{if(i.code==10){_IsLogined=false;h()}else{h()}}})}else{d.show()}},function(){var c=location.href.indexOf("/limitBuy/")>-1;if(c){$(this).removeClass("products-hover")}else{if(parseInt($(this).attr("idx"))%4==0){$(this).addClass("soon-list4").removeClass("soon-list-hover2")}$(this).removeClass("soon-list-hover").children("div.u_buyCount").hide()}$(this).find("div.f-add-attention").hide()});a.find("li[name='buyBox']").GoodsBuyFun()};var GetJPDataEx=function(c,a,b){$.getJSON("http://trade.1yyg.com/JPData/API.ashx?action="+c+"&"+a+"&fun=?",b)};var stopBubble=function(a){if(a&&a.stopPropagation){a.stopPropagation()}else{window.event.cancelBubble=true}};var addEvent=function(c,a,b,f){var d=function(){b.apply(f,arguments)};window.addEventListener?c.addEventListener(a,d,false):c.attachEvent("on"+a,d)},removeEvent=function(c,a,b){window.removeEventListener?c.removeEventListener(a,b,false):c.attachEvent("on"+a,b)};var getDefTip=function(){return _IsLimitBuy?("限购"+_LimitBuyNum+"人次")+(_BuyedNum>0?"，您已参与"+_BuyedNum+"人次":""):"请选择参与人次"};$.fn.GoodsCountFun=function(k,q){var o=$(this).children("input");var b=parseInt(o.attr("surplus"));var p=o.prev();var m=o.next();var v=$("#btnConfirmBuy");var t=$("#pageDialogMain");var d=$("#pageDialogClose");var l=o.parent().next();var u=function(z){if(z==""){l.attr("class","u-popup-Tip grayb").show().html(getDefTip())}else{l.attr("class","u-popup-Tip orange").show().html(z)}};var w="<s></s>已超过100人次，谨慎参与哦",h="<s></s>最少需参与1人次";var n=function(z){return _BuyedNum==0?"<s></s>最多可参与"+z+"人次":"<s></s>您已参与"+_BuyedNum+"人次，最多可参与"+z+"人次"};var y=l.next("div.u-popup-paytip");var f=function(A,z){_GotoPayPage=true;y.show().find("span.orange").html(A+".00");v.html("使用其它方式支付");t.css("height",z+"px")};var c=1;var s=function(z){c=z;o.val(z);if(_UserBalance>0){if(z>_UserBalance){f(z,350)}else{_GotoPayPage=false;y.hide();t.css("height","250px");v.html('确认支付<span class="mlr5">'+z+".00</span>元")}}else{f(z,340)}i()};var i=function(){if(c==1){p.addClass("num_ban");m.removeClass("num_ban")}else{if(c==b){p.removeClass("num_ban");m.addClass("num_ban")}else{p.removeClass("num_ban");if(_IsLimitBuy&&c==(_LimitBuyNum-_BuyedNum)){m.addClass("num_ban")}else{m.removeClass("num_ban")}}}};o.keyup(function(A){var z=o.val();if(z==""){u(h);s(1)}else{if(!_Ptn.test(z)){u("");s(c)}else{if(z==0){u(h);s(1)}else{if(z<=b){if(_IsLimitBuy){if(z>_LimitBuyNum-_BuyedNum){z=_LimitBuyNum-_BuyedNum;u(n(z))}else{if(z>100){u(w)}else{u("")}}}else{if(z>100){u(w)}else{u("")}}s(z)}else{z=b;if(_IsLimitBuy){if(z>_LimitBuyNum-_BuyedNum){z=_LimitBuyNum-_BuyedNum;u(n(z))}else{if(z>100){u(w)}else{u("<s></s>最多可参与"+z+"人次")}}}else{u("<s></s>最多可参与"+z+"人次")}s(z)}}}}}).keydown(function(z){if(13==((window.event)?event.keyCode:z.keyCode)){j(q)}}).val("1").select().focus().mouseover(function(){$(this).attr("mouseIn","1").focus().select();scrollFunc=function(B){B=B||window.event;if(B&&B.preventDefault){B.preventDefault()}else{window.event.returnValue=false}stopBubble(B);var C=0;if(B.wheelDelta){C=B.wheelDelta>0?1:-1}else{if(B.detail){C=B.detail<0?1:-1}}if(C&&o.attr("mouseIn")=="1"){var A=parseInt(o.val());if(C>0){if(A>0){if(A>=b){A=b;u("<s></s>最多可参与"+A+"人次")}else{u("");A=A+1;if(_IsLimitBuy){if(A>_LimitBuyNum-_BuyedNum){A=_LimitBuyNum-_BuyedNum;u(n(A))}else{if(A>100){u(w)}else{u("")}}}else{if(A>100){u(w)}else{u("")}}}}else{A=1}}else{if(A>1){A=A-1;if(A>100){u(w)}else{u("")}}else{A=1;u(h)}}o.val(A)}};var z=$(this).get(0);addEvent(z,"mousewheel",scrollFunc,z);addEvent(z,"DOMMouseScroll",scrollFunc,z)}).mouseout(function(){$(this).attr("mouseIn","0");var A=o.val();if(A>b){A=b}s(A);var z=$(this).get(0);removeEvent(z,"mousewheel",scrollFunc);removeEvent(z,"DOMMouseScroll",scrollFunc)});p.click(function(){var z=o.val();if(_Ptn.test(z)){var A=parseInt(z);if(A>1){u("");A--;if(A>100){u(w)}else{u("")}s(A)}else{}}return false});m.click(function(){var z=o.val();if(_Ptn.test(z)){var A=parseInt(z);if(A<b){u("");A++;if(_IsLimitBuy){if(A>_LimitBuyNum-_BuyedNum){A=_LimitBuyNum-_BuyedNum;u(n(A))}else{if(A>100){u(w)}else{u("")}}}else{if(A>100){u(w)}else{u("")}}s(A)}else{u("<s></s>最多可参与"+b+"人次")}}return false});$("body").keydown(function(z){if($("#divSuccMain").length>0&&13==((window.event)?event.keyCode:z.keyCode)){$.PageDialog.close()}});var g=function(){var z='<div class="content"><div id="divSuccMain" class="g-popup"><div class="g-pay-tip"><s class="f-pay-succeed"></s><p class="f-pay-tit gray6">支付成功！</p><p class="gray9">请进入＂<a href="http://member.1yyg.com/UserBuyList.do" target="_blank" class="gray6">我的云购记录</a>＂查看云购码</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">继续云购</a></p></div></div></div>';t.html(z);$("#btnClose").unbind("click").click(function(A){if(A&&A.stopPropagation){A.stopPropagation()}else{window.event.cancelBubble=true}$.PageDialog.close()})};var r=function(){var z='<div class="content"><div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail" style="left:50px;"></s><p class="f-pay-tit gray6" style="margin-left:110px;">参与失败！</p><p class="gray9" style="margin-left:110px;">被抢光了，您下手太慢了！</p><p class="f-pay-btn" style="margin-left:110px;"><a id="btnClose" href="javascript:;" class="orange_btn">确 认</a></p></div></div></div>';t.css({width:"320px",height:"210px"}).html(z);$("#btnClose").unbind("click").click(function(){$.PageDialog.close();location.reload()})};var x=function(){var z='<div class="content"><div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail" style="left:50px;"></s><p class="f-pay-tit gray6" style="margin-left:110px;">参与失败！</p><p class="gray9" style="margin-left:110px;">很抱歉，购买失败了！</p><p class="f-pay-btn" style="margin-left:110px;"><a id="btnClose" href="javascript:;" class="orange_btn">确 认</a></p></div></div></div>';t.css({width:"320px",height:"210px"}).html(z);$("#btnClose").unbind("click").click(function(){$.PageDialog.close();location.reload()})};var a=function(){var z='<div class="content"><div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail" style="left:50px;"></s><p class="f-pay-tit gray6" style="margin-left:110px;">提交失败！</p><p class="gray9" style="margin-left:110px;">提交失败，请重试！</p><p class="f-pay-btn" style="margin-left:110px;"><a id="btnClose" href="javascript:;" class="orange_btn">确 认</a></p></div></div></div>';t.css({width:"320px",height:"210px"}).html(z);$("#btnClose").unbind("click").click(function(){$.PageDialog.close()})};var j=function(z){if(parseInt(c)>0){var A=$("#p_buynext").find("a").hasClass("z-comms")?1:0;GetJPData("http://cart.1yyg.com","shopCartFast","codeID="+z+"&num="+c+"&isBuyNext="+A,function(B){if(B.code==0){if(_GotoPayPage){$cartFun.addShopCart(z,c,function(){$cartFun.setSelValue(z,c,function(){location.href="http://cart.1yyg.com/payment.do?bx="+A})})}else{buyFun=function(J){if(_IsBuySubmiting){return}_IsBuySubmiting=true;d.hide();var I='<div class="g-popup"><div class="g-buy-frame"><div class="g-submit"><p class="f-submit-tit gray6">正在提交，请稍候...</p><div class="u-progress u-progress-c3"><span class="pgbar" style="width:100%"><span class="pging"></span></span></div></div></div></div>';t.css({width:"435px",height:"225px"}).html(I).show();GetJPDataEx("UserPay","device=0&integral=0&isBalance=1&checkSN="+encodeURI(J)+"&isBuyNext="+A,function(K){var M=K.state;if(M==0){var L=function(){GetJPData("http://api.1yyg.com","getshopresult","t=2&id="+K.str,function(Z){if(Z.code==0){var N=Z.state;if(N==1){_IsCartChanged=true;g();var S=$("#ulGoodsList").find('div[codeid="'+z+'"]');var V=S.find("li.g-progress");var Q=V.find("span.orange").children("em");var T=parseInt(Q.html())+parseInt(c);Q.html(T);Q=V.find("span.gray6").children("em");var W=parseInt(Q.html());Q=V.find("span.blue").children("em");var U=parseInt(Q.html())-parseInt(c);Q.html(U);var Y=parseFloat(T)/W;var X=$(window).width()<1190?217:266;var R=parseInt(Y*X);Q=V.find("dl.m-progress").children("dt");Q.attr("title","已完成"+formatFloat(Y*100)+"%").html('<b style="width:'+(parseInt(R)==0?1:R)+'px;"></b>');Q=S.children("div.u_buyCount");if(Q.length>0){Q.find("em").html(parseInt(Q.find("em").html())+parseInt(c))}else{var P=1;if(parseInt(S.attr("idx"))%4==0){P=0}var O=S.width()-P;Q.width(O+"px").html("<p></p><h3>您已参与<em>"+c+"</em>人次</h3>")}}else{if(N==2){r()}else{x()}}d.show()}else{setTimeout(L,500)}_IsBuySubmiting=false})};setTimeout(L,3000)}else{if(M==10){location.reload()}else{if(M==1||M==4){r()}else{a()}}d.show();_IsBuySubmiting=false}})};if(B.num==0){buyFun("")}else{showPaypwdDiglog()}}}else{if(B.code==1){var G=k.find("li.g-progress");var D=B.NewCodeInfo;if(D!=""){var H=D.split("|");if(H!=null&&H.length==6){var E=function(){k.attr("codeid",H[0]);k.find("li.soon-list-name").find("em").html(H[1]);k.find("li.gray6").html("价值：￥"+formatFloat(H[3]));G.find("dt").attr("title","已完成"+H[5]+"%");G.find("b").attr("style","width:"+H[5]+"%");G.find("span.orange").find("em").html(H[2]);G.find("span.gray6").find("em").html(H[3]);G.find("span.blue").find("em").html(H[4])};var C=function(){E();j(H[0])};var F=function(){E()};ConfirmDialog("本云已满员，是否云购下一云？",C,F)}}else{FailDialog("本商品已结束");var G=k.find("li.g-progress");G.find("dt").attr("title","已完成100%");G.find("b").attr("style","width:100%");G.find("span.orange").find("em").html(G.find("span.gray6").find("em").html());G.find("span.blue").find("em").html("0")}}else{if(B.code==10){location.reload()}else{a()}}}})}else{o.focus().select()}};v.click(function(){j(q);return false}).hover(function(){if(!_GotoPayPage){}},function(){})};var showFailFun=function(a){$.PageDialog('<div class="mAltFail"><s></s>'+a+"</div>",{W:150,H:60,close:false,autoClose:true,submit:function(){location.reload()}})};var showOverLimitFun=function(){$.PageDialog('<div class="mAltFail"><s></s>您参与人次已达上限！</div>',{W:220,H:53,close:false,autoClose:true,submit:function(){}})};var ConfirmDialog=function(h,b,c,a,j){var d=350;var g=160;if(typeof(a)!="undefined"){d=a}if(typeof(a)!="undefined"){g=j}var i=null;var k='<div class="z-popUp z-pop-box"><span class="gray3">'+h+'</span><a href="javascript:;" title="取消" class="z-btn-cancel">取消</a><a href="javascript:;" title="确定" class="z-btn-determine">确定</a></div>';var f=function(){var l=$("#pageDialog");l.find("a.z-btn-determine").click(function(){if(typeof(b)!="undefined"&&b!=null){b()}$.PageDialog.close()});l.find("a.z-btn-cancel").click(function(){if(typeof(c)!="undefined"&&c!=null){c()}$.PageDialog.close()})};$.PageDialog(k,{W:d,H:g,close:false,autoClose:false,ready:f})};var loginFun=function(b){var a=function(){var c=new popLogin();PagePOPLoginOK=function(){_IsLogined=true;c.hide();b()};c.show()};if(_IsLoadLoginJS){a()}else{Base.getScript("http://skin.1yyg.net/JS/popLogin.js?date=150703",function(){_IsLoadLoginJS=true;a()})}};$.fn.GoodsBuyFun=function(){var b=$(this);var c=b.parent().parent().parent();var a=c.find("img[name='goodsImg']");b.children("a").eq(1).click(function(){var g=c.attr("codeID");var f=$(this);var d=function(){$cartFun.addShopCart(g,1,function(i){if(i.code==0){_IsCartChanged=true;h()}else{if(i.code==1){if(i.num==0){FailDialog("啊哦~！被抢光啦！",300,60,function(){location.reload()})}else{var n=c.find("li.g-progress");var k=i.str;if(k!=""){var o=k.split("|");if(o!=null&&o.length==6){var l=function(){c.attr("codeid",o[0]);c.find("li.soon-list-name").find("em").html(o[1]);c.find("li.gray6").html("价值：￥"+formatFloat(o[3]));n.find("dt").attr("title","已完成"+o[5]+"%");n.find("b").attr("style","width:"+o[5]+"%");n.find("span.orange").find("em").html(o[2]);n.find("span.gray6").find("em").html(o[3]);n.find("span.blue").find("em").html(o[4]);g=parseInt(o[0])};var j=function(){l();d()};var m=function(){l()};ConfirmDialog("本云已满员，是否云购下一云？",j,m)}}else{FailDialog("本商品已结束");n.find("dt").attr("title","已完成100%");n.find("b").attr("style","width:100%");n.find("span.orange").find("em").html(n.find("span.gray6").find("em").html());n.find("span.blue").find("em").html("0")}}}else{if(i.code==2){FailDialog("哎呀！购物车满啦，删除一些吧！",300)}else{if(i.code==3){_IsCartChanged=true;h()}else{showFailFun("商品添加失败！")}}}}})};var h=function(){var i=function(){showParabola(f,1,a,function(){_InsertIntoCart()})};if(_IsLoadPlJs){i()}else{Base.getScript("http://skin.1yyg.net/JS/Parabola.js?date=150129",function(){_IsLoadPlJs=true;i()})}};d();return false})};var getListPaging=function(h,g,k,l,b){var c=1,j=1,f=1;var a="";c=parseInt(h/g);if(h%g>0){c++}if(c<1){c=1}a+='<div class="g-pagination w1190">';if(h>0){j=1;while(j+l<c+1&&j+l<k+2){j+=l-2}f=j+l-1;if(f>c){f=c}if(k==1){a+='<span class="f-noClick"><a title="上一页" href="javascript:;"><i class="f-tran f-tran-prev">&lt;</i>上一页</a></span>'}else{a+='<span><a title="上一页" href="'+b(k-1)+'"><i class="f-tran f-tran-prev">&lt;</i>上一页</a></span>'}if(j>1){a+='<span><a href="'+b(1)+'">1</a></span><span>…</span>'}for(var d=j;d<=f;d++){if(d!=k){a+='<span><a href="'+b(d)+'">'+d+"</a></span>"}else{a+='<span class="current"><a>'+d+"</a></span>"}}if(f<c){a+='<span>…</span><span><a href="'+b(c)+'">'+c+"</a></span>"}if(k<c){a+='<span><a href="'+b(k+1)+'">下一页<i class="f-tran f-tran-next">&gt;</i></a></span>'}else{a+='<span class="f-noClick"><a>下一页<i class="f-tran f-tran-next">&gt;</i></a></span>'}}a+='<span class="f-mar-left">共<em>'+c+"</em>页，去第</span>";a+='<span><input type="text" value="'+k+'">页</span>';a+='<span class="f-mar-left"><a id="btnGotoPage" href="javascript:;" title="确定">确定</a></span>';a+="</div>";return a};var showPayPasswordObject={payPasswordDialogHtml:'<div class="g-pwd-wrapper"><div class="g-pwd-inner"><h6>请输入6位支付密码</h6><div class="g-pwd-all"><input type="hidden"><div class="icon-wrapper"><input type="text" maxlength="6" id="passwordInput" style="height:0;margin:0;padding:0;border:none;" /><div class="icon-inner" id="sixDigitPassword"><i class="active"><b style="visibility:hidden;"></b></i><i><b style="visibility:hidden;"></b></i><i><b style="visibility:hidden;"></b></i><i><b style="visibility:hidden;"></b></i><i><b style="visibility:hidden;"></b></i><i><b style="visibility:hidden;"></b></i><span style="visibility: visiable; left: 0px;" id="span"></span></div></div><div class="g-warn"></div></div><div class="memory"><a href="http://member.1yyg.com/UserAuth-10.do" target="_blank" class="gray9">忘记支付密码？</a></div></div></div>'};var showPaypwdDiglog=function(){$.PageDialog(showPayPasswordObject.payPasswordDialogHtml,{W:380,H:181,close:true,autoClose:false,ready:_ReadyFun})};var _ReadyFun=function(){var c=$("#sixDigitPassword",$("#pageDialogMain"));var b=$("#passwordInput",$("#pageDialogMain"));var a=$("#span",$("#pageDialogMain"));var d=$("i",$("#pageDialogMain"));b.focus();c.click(function(){b.focus()});b.focus(function(){var f=b.val();passwordProcess(f.length)}).blur(function(){a.hide();d.removeClass("active")}).keydown(function(f){var i=$(this);var h=window.event?f.keyCode:e.keyCode;if(!isKeyCodeDigital(h)){if(h===8){var j=i.val();i.val(j.substring(0,j.length-1));var g=i.val();passwordProcess(g.length);return false}return false}}).keyup(function(){b.val(b.val().replace(/[^\d]+/g,""));var g=b.val();var f=$(this);passwordProcess(g.length)})};function passwordProcess(c){var b=$("#passwordInput",$("#pageDialogMain"));var a=$("#span",$("#pageDialogMain"));var d=$("i",$("#pageDialogMain"));if(c<6){a.show();d.removeClass("active");d.each(function(f,g){if(f<=c-1){$(g).find("b").css({visibility:"visible"})}else{$(g).find("b").css("visibility","hidden")}});d.eq(c).find("b").css("visibility","hidden");d.eq(c).addClass("active");a.css("visibility","visible");a.css("left",d.outerWidth()*c+"px")}else{showErrInfo("正在验证，请稍候...");a.hide();d.removeClass("active");d.find("b").css("visibility","visible");payProcess(b)}}function payProcess(a){var b=a.val();if(/^\d{6}$/.test(b)){GetJPData("https://passport.1yyg.com","checkUPaypwd","paypwd="+b,function(c){if(c.state==0){window.buyFun(c.str)}else{if(c.state==1){if(c.num==-5){showErrInfo("输入错误，您还可输入"+c.str+"次")}else{if(c.num==-4){showErrInfo("错误次数过多，支付密码已被冻结")}}}else{showErrInfo("支付密码验证失败，请重试")}}a.val("").focus()})}}var showErrInfo=function(a){$("#pageDialog").find("div.g-warn").html('<i class="u-personal"></i>'+a+"")};function isKeyCodeDigital(a){return((a>=48&&a<=57)||(a>=96&&a<=105))?true:false}var isDebug=false;var version=isDebug?new Date().getTime():"17011702";Base.getScript("http://skin.1yyg.net/JS/jquery.onebuy.js?date="+version);
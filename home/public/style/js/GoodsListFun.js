var CBLFun=null;$(document).ready(function(){var c="http://www.1yyg.com";var a="http://skin.1yyg.net";var b=function(){var r=parseInt($("#hidSortID").val());var v=parseInt($("#hidBrandID").val());var w=parseInt($("#hidNvgID").val());var A=parseInt($("#hidPreView").val());var f=parseInt($("#hidPageIndex").val());var I=parseInt($("#hidOrder").val());var H=parseInt($("#hidLimitTag").val())==10;var u=0;var h=20;var n=40;var o=n/h;var p=1;var s=0;var g=0;var t=$("#divTopPageInfo");var G=$("#ulGoodsList");var B=$("#divPageNav");var m=$("#divLoadingLine");var x=true;var z=false;var y=false;var q=new Object();$(document).on("click","#mPositionContainer a.f-close-line",function(){var J=$(this);var K=J.parent().prev().prev().find("a").attr("href");window.location.href=K});var k=$("#ulBrandList");var E=k.height();var j=k.children("li").length;var D=28;var F=false;var C=function(){var K=D;var J=$(window).width()<1190?7:8;if(j%J==0){K=(j/J)*D}else{K=parseInt(j/J+1)*D}return K};$("#btnExpend").click(function(J){J.preventDefault();if(F){k.height(E+"px");$(this).removeClass("hover").html('展开<div class="f-top-arrow"><cite>◆</cite><b>◆</b></div>')}else{k.height(C()+"px");$(this).addClass("hover").html('收起<div class="f-top-arrow"><cite>◆</cite><b>◆</b></div>')}F=!F});$(window).resize(function(){if(F){k.height(C()+"px")}G.find("div.u_buyCount").each(function(){$(this).html("").hide()})});$("li[name='liPrice']").each(function(K,J){if(K==0){$(this).hover(function(){$(this).hide().next().show()},function(){})}else{$(this).hover(function(){},function(){$(this).hide().prev().show()})}});var d=function(){var J=(f-1)*n;return"sortID="+r+"&brandID="+v+"&nvgID="+w+"&preview="+A+"&orderFlag="+I+"&FIdx="+(J+1)+"&EIdx="+(J+n)+"&isCount="+p};var i=function(){p=1;return"FIdx=1&EIdx=20&IsCount=1"};var l=function(){var L=function(){m.show();var N=H?"getLimitGoodsPage":"getGoodsList";var M=H?i():d();GetJPData("http://api.1yyg.com",N,M,function(R){var O=H?R.code:R.Code;if(O==0){var Q=function(){if(p==1){s=H?R.totalCount:R.Count;g=s%n==0?s/n:parseInt(s/n)+1;p=0}var T='<p class="Fl">共<em class="orange">'+s+"</em>件商品<b>"+f+"</b>/"+g+'</p><div class="u-list-btn fl"><a href="'+(f==1?"javascript:;":K(f-1))+'" class="'+(f==1?"u-btn-gray":"")+'" title="上一页"><span class="f-tran f-tran-prev">&lt;</span>上一页</a><a href="'+(f==g?"javascript:;":K(f+1))+'" class="'+(g>1?(f==g?"u-btn-gray":""):"u-btn-gray")+'" title="下一页">下一页<span class="f-tran f-tran-next">&gt;</span></a></div>';t.html(T);m.hide();var S=H?R.listItems:R.Data.Tables.Table1.Rows;var U=S.length;if(U>0){q["page"+f]=S;J()}else{u=o}};if(z){Q()}else{Base.getScript("http://skin.1yyg.net/JS/GoodsComm.js?date=16072501",function(){z=true;Q()})}}else{m.hide();if(u==0){var P='<div class="announced-soon clrfix"><div class="kt-icon"><img src="http://skin.1yyg.net/images/kt-ll.jpg"><p class="gray">很抱歉，没有找到相关商品</p></div></div>';G.hide().after(P)}else{if(f!=1&&s>n){B.html(getListPaging(s,n,f,5,K)).show()}}u=o}x=false})};var J=function(){u++;var Q=q["page"+f];if(Q!=null&&Q!=undefined){var W=Q.length;var M=(u-1)*h;var aa=M+h;aa=aa>W?W:aa;var V="";var T="",ag="";var N=0;var R=0;var O=0;var X=0;var ai=0;G.show();var ad=$(window).width()<1190?217:266;for(var af=M;af<aa;af++){V="";var P="";var ac=H?10:parseInt(Q[af].goodsTag);switch(ac){case 1:P+='<div class="f-callout"><span class="F_goods_xp transparent-png">新品</span></div>';break;case 2:P+='<div class="f-callout"><span class="F_goods_tj transparent-png">推荐</span></div>';break;case 3:P+='<div class="f-callout"><span class="F_goods_rq transparent-png">人气</span></div>';break;case 10:P+='<div class="f-callout"><span class="F_goods_xg transparent-png">限购</span></div>';break}T="(第<em>"+Q[af].codePeriod+"</em>云)&nbsp;"+Q[af].goodsSName;ag="(第"+Q[af].codePeriod+"云)"+Q[af].goodsSName;N=parseInt(Q[af].codeSales);R=parseInt(Q[af].codeQuantity);O=parseInt(R-N);X=parseFloat(N)/R;ai=parseInt(X*ad);V+="<div idx="+(af+1)+' class="soon-list-con '+((af+1)%4==0?"soon-list4":"")+'" codeID="'+Q[af].codeID+'" goodsID="'+Q[af].goodsID+'"><div class="soon-list"><ul><li class="g-soon-pic"><a href="/products/'+Q[af].goodsID+'.html" target="_blank" title="'+ag+'"><img name="goodsImg" src="http://img.1yyg.net/GoodsPic/pic-200-200/'+Q[af].goodsPic+'" /></a></li><li class="soon-list-name"><a href="/products/'+Q[af].goodsID+'.html" target="_blank" title="'+ag+'">'+T+'</a></li><li class="gray6">价值：￥'+formatFloat(Q[af].codePrice)+'</li><li class="g-progress"><dl class="m-progress"><dt title="已完成'+formatFloat(X*100)+'%"><b style="width:'+(N==0?0:(parseInt(ai)==0?1:ai))+'px;"></b></dt><dd><span class="orange fl"><em>'+N+'</em>已参与</span><span class="gray6 fl"><em>'+R+'</em>总需人次</span><span class="blue fr"><em>'+O+'</em>剩余</span></dd></dl></li><li name="buyBox" codePeriod="'+Q[af].codePeriod+'" limitBuy="'+Q[af].codeLimitBuy+'"><a  href="javascript:;" title="立即1元云购" class="u-now" id="btnYgOneBuy'+af+'">立即1元云购</a><a href="javascript:;" class="u-cart"><s></s></a></li></ul>'+P+'<div class="f-add-attention"></div></div></div>';var U=$(V);if((af+1)==aa&&aa%4!=0){U.addClass("f-add-borR")}G.append(U);U.GoodsItemFun();var Y="http://img.1yyg.net/GoodsPic/pic-70-70/"+Q[af].goodsPic;var Z=Q[af].codeLimitBuy>0?true:false;var ah=[{isLimitBuy:Z,image:Y,codeId:Q[af].codeID,goodsId:Q[af].goodsID,periods:Q[af].codePeriod,surplus:O,callBackFunc:ab}];$("#btnYgOneBuy"+af).OneBuy({extend:ah})}function ab(al){if(al!=null){e="goodsID="+al.goodsId;var aq=$("div["+e+"]").find("div.soon-list").eq(0);var ar=aq.find("li.g-progress");if(al.alreadybuy==parseInt(al.totalnum)){al.ratio=100}var ap=aq.find("li[name=buyBox]");var an=ap.parent().find("li.soon-list-name").find("em");var am=ap.parent().find("li.soon-list-name").find("a");ap.attr("codeperiod",al.periods);an.html(al.periods);am.attr("title",an.text());if(al.ratio==100){ar.find("dt").attr("title","已完成0%");ar.find("b").attr("style","width:0%");ar.find("span.orange").find("em").html(0);ar.find("span.gray6").find("em").html(al.totalnum);ar.find("span.blue").find("em").html(al.totalnum)}else{var ao=((al.alreadybuy/al.totalnum)*100).toFixed(0);ar.find("dt").attr("title","已完成"+ao+"%");ar.find("b").attr("style","width:"+ao+"%");ar.find("span.orange").find("em").html(al.alreadybuy);ar.find("span.gray6").find("em").html(al.totalnum);ar.find("span.blue").find("em").html(al.surplus)}}}if(W<h||u*h==s){u=o}if(u>=o){if(s>n){B.html(getListPaging(s,n,f,5,K)).parent().show();if(!y){y=true;var aj=$("#btnGotoPage");var S=aj.parent().prev().find("input");var ak=function(){var al=parseInt(S.val());if(al>0){if(al>g){al=g}window.location.href=K(al)}return false};var ae=1;S.keyup(function(am){var an=am||window.event||arguments.callee.caller.arguments[0];if(an){if(an.keyCode==13){ak()}else{var al=$(this).val();if(!(/^\d+$/.test(al))){if(al==""){$(this).val("")}else{$(this).val(ae)}}else{ae=al;$(this).val(al)}}}}).mouseover(function(){$(this).focus().select()}).blur(function(){if(!(/^\d+$/.test($(this).val()))){ae=1;$(this).val(ae)}});aj.click(function(){ak();return false})}}else{B.hide()}}G.show()}m.hide()};var K=function(M){var S="/list/";if(r>0){S+="i"+r}if(w>0){S+="n"+w}if(v>0){S+="b"+v}if(A>0){S+="p1"}S+="m"+M;S+=".html";var O=location.search;var N=new Object();if(O.indexOf("?")!=-1){var R=O.substr(1);var Q=R.split("&");for(var P=0;P<Q.length;P++){N[Q[P].split("=")[0]]=decodeURI(Q[P].split("=")[1])}}if(I>10){S+="?r="+I}return S};this.nextList=function(){J()};this.initPage=function(){L()}};$(window).scroll(function(){if(u<o&&!x){var J=$(window).scrollTop()+$(window).height();var K=G.offset().top+G.height();if(J>=K){if(x){return}if(G.children().length==0){return}x=true;CBLFun.nextList()}}});CBLFun=new l();CBLFun.initPage()};b();Base.getScript("http://skin.1yyg.net/JS/jquery.onebuy.js?date=17011702")});
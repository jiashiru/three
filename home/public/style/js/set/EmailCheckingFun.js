var YG=YG||{};YG.EmailChecking={ckEmail:function(a){var b=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;return b.test(a)},ckNoSupEmail:function(a){var b=/^.*@(vip.)?(163|126|yeah)\.(com|net)$/;return b.test(a)},isDigitLetter:function(b){var a=/^[0-9a-zA-Z]{6,}$/;return a.test(b)},passportUrl:"https://passport.1yyg.com",showErrInfo:function(b,d){var c=this;var a=null;if(b==1){a=c._TipObj1}else{a=c._TipObj2;c._isLoaded2=false}if(c._Timer!=null){clearTimeout(c._Timer)}if(d==""){a.html("").hide()}else{a.html('<div class="form-orange-tips">'+d+"</div>").show();c._Timer=setTimeout(function(){a.html("")},3000)}return false},EmailErr:["邮箱号不能为空","您输入的邮箱号有误","该邮箱已被注册，如号码无误请联系客服","很抱歉，暂不支持此类邮箱，建议您使用QQ邮箱"],EmailSNErr:["请输入邮箱里的验证码","验证码长度不对吧","验证码错误"],_DefColor:"#bbbbbb",_FocusColor:"#333333",_EmailDefTip:"请输入新邮箱号",_EmailSNDefTip:"请输入6位验证码",_EmailVal:"",_EmailSNVal:"",emailobj:null,_TipObj1:null,_TipObj2:null,_EmailSN:null,$btnSubmit:null,$btnSend:null,_Timer:null,init:function(){var a=this;a.emailobj=$("#txtEmail");a._TipObj1=$("#div_tips1");a._TipObj2=$("#div_tips2");a._EmailSN=$("#txtEmailSN");a.$btnSubmit=$("#butSubmit");a.$btnSubmit.click(function(){a.isDragEnabled=true;a.submitCheckData()});a.vcClickEventReg();a.emailobj.focus(function(){var b=$(this).val().trim();if(b==a._EmailDefTip){$(this).val("").css("color",a._FocusColor)}}).blur(function(){var b=$(this).val().trim();if(b==""){$(this).val(a._EmailDefTip).css("color",a._DefColor)}}).val(a._EmailDefTip).css("color",a._DefColor).keydown(function(){var b=(window.event)?event.keyCode:e.keyCode;if(b==32){return false}else{if(b==13){a.submitCheckData();return false}}return true});a.$btnSend=$("#btnSendSN")},submitCheckData:function(){var b=this;var a=b.emailobj.val().trim();b._EmailVal=b.emailobj.val().trim();if(b._EmailVal==""||b._EmailVal==b._EmailDefTip){b.showErrInfo(1,b.EmailErr[0])}else{if(!b.ckEmail(b._EmailVal)){b.showErrInfo(1,b.EmailErr[1])}else{if(b.ckNoSupEmail(b._EmailVal)){b.showErrInfo(1,b.EmailErr[3])}else{GetJPData(b.passportUrl,"checkname","name="+a+"&ckmail=1",function(c){if(c.state==0){b.showVcDialog()}else{if(c.state==-101){b.showErrInfo(1,b.EmailErr[3])}else{if(c.state==1){b.showErrInfo(1,b.EmailErr[2])}else{b.showErrInfo(1,b.EmailErr[1])}}}})}}}},showVcDialog:function(){var b=this;var a=b.emailobj.val().trim();GetJPData("https://passport.1yyg.com","getVcChar","key="+a+"&ischeck=1",function(d){if(d.state==1){FailDialog("获取验证码太频繁，请稍后再试",300,60);return false}if(d.state==0){var c='<div class="u-vc-widget"><div class="vc-ready-container"><h3>请完成验证以确认发送</h3><div class="vc-wrapper"><div class="vc-btn-container" id="dragBtnContainer1"><div class="vc-slide-text"><span>请按住滑块，拖动到最右边</span></div><div class="vc-slideBtnLeft" id="dragBtnLeft1"><span class="canvas-Title">请点击图中的"<strong id="selectedChar1"></strong>"字</span><span class="canvas-Title" style="display: none;">验证通过！</span><a href="javascript:;" id="refreshVcCode1" class="passport-icon refresh" style="display: none; "></a></div><div class="vc-slideBtn" id="dragBtn1"><i class="passport-icon ready-status"></i></div></div><div class="canvas-wrapper" style="display:none;"><div class="canvas-container" id="canvasContainer1" style=""><img id="vcCanvas1" class="vc-canvas" src="" alt=""></div></div></div></div></div>';$.PageDialog(c,{W:408,H:263,close:true,autoClose:false,ready:function(){b.vcEvtReg()}})}})},vcEvtReg:function(){var d=this;var b=d.emailobj.val().trim();var a=$("#pageDialog");d.$vcCanvas=$("#vcCanvas1",a);d.$vcCanvas.css({width:d.canvasWidth+"px"});d.$dragBtn=$("#dragBtn1",a);d.$dragBtnLeft=$("#dragBtnLeft1",a);d.$dragBtnContainer=$("#dragBtnContainer1",a);d.$canvasContainer=$("#canvasContainer1",a);d.$selectedChar1=$("#selectedChar1",a);var f=d.$dragBtnContainer.outerWidth();var c=d.$dragBtn.outerWidth();d.$dragBtn.draggable({containment:"#dragBtnContainer1",start:function(){if(d.isDragEnabled===false){return false}},drag:function(h,i){var g=i.position.left;d.$dragBtnLeft.css("width",g+"px")},stop:function(h,i){var g=i.position.left;if(g<f-c){d.$dragBtn.animate({left:"0"});d.$dragBtnLeft.animate({width:"0"})}else{GetJPData("https://passport.1yyg.com","getVcChar","key="+b,function(j){if(j.state==1){$.PageDialog.close();FailDialog("请求验证码太频繁，请稍后再试",300,60);return false}else{if(j.state==0){d.isDragEnabled=false;var k=j.str;d.$selectedChar1.text(k);d.$dragBtnContainer.children(".vc-slide-text").hide();d.$dragBtnContainer.children(".vc-slideBtnLeft").find("span:eq(1)").hide();d.$dragBtnContainer.children(".vc-slideBtnLeft").find("span:eq(0),a").show();d.$canvasContainer.parent().show();d.$canvasContainer.css("height",d.canvasHeight+"px");d.$dragBtn.css({"float":"left",left:g+"px"});d.$dragBtn.children("i").removeClass("ready-status vali-status wrong-status right-status").addClass("vali-status");d.$vcCanvas.attr("src","https://passport.1yyg.com/api/GetVcImg.html?"+d.getVcImgParam(k))}}})}}})},vcClickEventReg:function(){var a=this;var b=null;$(document).on("click","#refreshVcCode1",function(){if(b!=null){console.log("too fast！！");return}b=setTimeout(function(){b=null},200);a.$dragBtn.children("i").attr("class","passport-icon ready-status vali-status");a.showVcCode()});$(document).on("click","#vcCanvas1",function(f){var d=$("#canvasContainer1").offset().left;var h=$("#canvasContainer1").offset().top;var c=f.pageX-d;var g=f.pageY-h;a.$vcCanvas.hide();GetJPData("https://passport.1yyg.com","VcCompare","x="+c+"&y="+g,function(i){if(i.state==1){if(i.num==1){a.$dragBtn.children("i").attr("class","passport-icon wrong-status");a.showVcCode();return false}else{$.PageDialog.close();FailDialog("请求验证码太频繁，请稍后再试",300,60);return false}}else{if(i.state==0){a.$canvasContainer.hide();a.$dragBtnLeft.find("span:eq(0),a").hide();a.$dragBtnLeft.find("span:eq(1)").show();a.$dragBtn.children("i").attr("class","passport-icon right-status");setTimeout(function(){a.SendEmailSN()},500)}}})})},showVcCode:function(){var b=this;var a=b.emailobj.val().trim();GetJPData("https://passport.1yyg.com","getVcChar","key="+a,function(c){if(c.state==1){$("#pageDialogClose").trigger("click");FailDialog("获取验证码太频繁");return false}else{if(c.state=="0"){var d=c.str;$("#selectedChar1").text(d);b.$dragBtnContainer.children(".vc-slideBtnLeft").find("span:eq(1)").hide();b.$dragBtnContainer.children(".vc-slideBtnLeft").find("span:eq(0),a").show();b.$canvasContainer.parent().show();b.$canvasContainer.css("height",b.canvasHeight+"px");b.$vcCanvas.attr("src","https://passport.1yyg.com/api/GetVcImg.html?"+b.getVcImgParam(d)).show()}}})},isAdvancedVcCode:false,isDragEnabled:true,canvasWidth:308,canvasHeight:120,getVcImgParam:function(b){var c=this;var a="width="+c.canvasWidth+"&height="+c.canvasHeight+"&isAdvancedVcCode="+c.isAdvancedVcCode+"&selectedChar="+b;return a},SendEmailSN:function(){var d=this;var a=120;var b=$("#btnSendSN");var c=function(){if(a>0){b.html("重新发送("+a+")").addClass("current").unbind("click");a--;setTimeout(c,1000)}else{b.removeClass("current").html("重新发送").bind("click",function(){if($(this).hasClass("current")===false){d.$btnSubmit.trigger("click")}})}};GetJPData(d.passportUrl,"sendCodeEmail","userEmail="+d._EmailVal,function(f){if(f.state==0){c();$("#divSend").hide();$("#divChecking").show();$("#butSaveSubmit").click(function(){d.submitSaveData()});d._EmailSN.focus(function(){var g=$(this).val().trim();if(g==d._EmailSNDefTip){$(this).val("").css("color",d._FocusColor)}}).blur(function(){var g=$(this).val().trim();if(g==""){$(this).val(d._EmailSNDefTip).css("color",d._DefColor)}}).val(d._EmailSNDefTip).css("color",d._DefColor).keydown(function(){var g=(window.event)?event.keyCode:e.keyCode;if(g==32){return false}else{if(g==13){d.submitSaveData();return false}}return true});OKDialog("验证邮件发送成功！");$("#b_account").html(d._EmailVal)}else{if(f.state==2){d.showErrInfo(1,"请不要频繁获取邮箱验证信息")}else{d.showErrInfo(1,"请检查邮箱号码是否正确")}}})},_isLoaded2:false,submitSaveData:function(){var b=this;if(b._isLoaded2){return}b._isLoaded2=true;b._EmailSNVal=b._EmailSN.val().trim();if(b._EmailSNVal==""||b._EmailSNVal==b._EmailSNDefTip){b.showErrInfo(2,b.EmailSNErr[0]);return}else{if(!b.isDigitLetter(b._EmailSNVal)){b.showErrInfo(2,b.EmailSNErr[2]);return}}var a=function(){$("#butSaveSubmit").hide();var c=$("#hidAuth").val();GetJPData("","updateMemberCenterUserEmail","email="+b._EmailVal+"&sn="+b._EmailSNVal+"&auth="+c,function(g){if(g!=null&&g.code==0){var f=$("#hidForward").val();if(f==""){f="emailcheckingok.do"}var i=g.type;var d=i==0?"验证成功!":"保存成功，恭喜您获得10福分!";var h=i==0?160:260;OKDialog(d,h,60,function(){setTimeout(function(){location.replace(f)},3000)});return}else{if(g.code==10){location.reload()}else{b.showErrInfo(2,"验证码错误!")}}$("#butSaveSubmit").show()})};GetJPData(b.passportUrl,"verifyEmailSN","userEmail="+b._EmailVal+"&sn="+b._EmailSNVal,function(c){if(c.state==0){a()}else{b.showErrInfo(2,b.EmailSNErr[2])}})}};$(document).ready(function(){var a="http://skin.1yyg.net";Base.getScript(a+"/JS/AjaxFun.js?date=20130123",function(){Base.getScript("https://skin.1yyg.net/Plugins/jquery-ui.js?date=161026",YG.EmailChecking.init())})});
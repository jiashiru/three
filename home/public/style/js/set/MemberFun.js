var EHad=null;$(function(){var skinDomain="http://skin.1yyg.net";$.fn.jcarousel=function(options){var settings={itemWidth:182,showNum:4,initIndex:1,initCallback:function(){}};options=options||{};$.extend(settings,options);var isStart=false;var jcarObj=this;var jcarLeft=0;var jcarWidth=0;var itemCount=$("div.productsCon",this).length;var prevObj=new prevButton(this.parent().siblings(".z-prev"));prevObj.setEnabled();var nextObj=new nextButton(this.parent().siblings(".z-next"));nextObj.setEnabled();jcarWidth=itemCount*settings.itemWidth;jcarLeft=settings.itemWidth;jcarObj.width(jcarWidth).css("left","0px");jcarObj.show("fast",settings.initCallback);function nextButton(btnObj){this.btn=btnObj;this.setDisabled=function(){this.btn.unbind("click").hide()};this.setEnabled=function(){this.btn.unbind("click").bind("click",function(){if(isStart){return}isStart=true;jcarObj.animate({left:"-"+jcarLeft+"px"},"fast",function(){jcarObj.append(jcarObj.children().eq(0)).css("left","0px");isStart=false});return false});if(itemCount>4){this.btn.show()}}}function prevButton(btnObj){this.btn=btnObj;this.setDisabled=function(){this.btn.unbind("click")};this.setEnabled=function(){this.btn.unbind("click").bind("click",function(){if(isStart){return}isStart=true;jcarObj.prepend(jcarObj.children().eq(itemCount-1)).css("left","-"+jcarLeft+"px");jcarObj.stop().animate({left:"0px"},"fast",function(){isStart=false});return false});if(itemCount>4){this.btn.show()}}}};var BindEvents=function(){var $cartFun=new $CartComm();$("#a_transaccount").bind("click",function(){$.cookie("TransAccount",1);location.href="/UserBalance.do";return false});$("#a_drq").bind("click",function(){$.cookie("drq",1);location.href="/OrderList.do";return false});$("#a_dsh").bind("click",function(){$.cookie("dsh",1);location.href="/OrderList.do";return false});$("#a_dfh").bind("click",function(){$.cookie("dfh",1);location.href="/OrderList.do";return false});$("#div_stat").show();var isLoadAddCart=false;var add2CartFun=function(OkMsg,CodeID,canBuy){if(isLoadAddCart){return}isLoadAddCart=true;$cartFun.addShopCart(CodeID,1,function(result){if(result.code==0){OKDialog(OkMsg,200,60,function(){isLoadAddCart=false;_MemberUpdateCartNum()})}else{if(result.code==2){FailDialog("哎呀！购物车满啦，删除一些吧！",300)}else{FailDialog("操作失败，请重试["+result.code+"]！",200)}}isLoadAddCart=false},canBuy)};$("#a_UserPhoto").hover(function(){$(this).next("p").show()},function(){$(this).next("p").hide()}).parent().bind("click",function(){location.href="/UserPhoto.do?forward="+escape("/index.do");return false});var closeMsg=function(){var offFun=function(obj,index){GetJPData("","colseMessage","type="+index,function(result){var _Code=result.code;if(_Code==0){$(obj).parent().remove()}})};this.off=function(obj,index){offFun(obj,index)}};EHad=new closeMsg();try{var ShareTitle="";var ShareUrl="";var txtObj=$("#txtInfo");var documentTitle=document.title;txtObj.focus(function(){$(this).addClass("z-focus")}).blur(function(){$(this).removeClass("z-focus")});var loadBDShareJS=function(){window._bd_share_config={common:{bdSnsKey:{},bdText:"",bdMini:"2",bdUrl:ShareUrl,bdPic:"",bdStyle:"2",bdSize:"16",onBeforeClick:function(cmd,config){$("#bdshare_weixin_qrcode_dialog").remove();document.title=txtObj.val().replace(ShareUrl,"")},onAfterClick:function(cmd,config){document.title=documentTitle}},share:{}};with(document){0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date()/3600000)]}};var _RID=$.cookie("_uid");if(_RID!=null&&parseInt(_RID)>0){Base.getScript(skinDomain+"/JS/ZeroClipboard.min.js?date=20150210",function(){GetJPData("http://y.1yyg.com","getShortUrl","urlType=0",function(data){if(data.code==0){ShareTitle="1元就能买iPhone 6S，一种很有意思的购物方式，快来看看吧！";ShareUrl=data.shortUrl;txtObj.val(ShareTitle+"\n"+ShareUrl);var $copyBtn=$("#btnCopy"),clip=new ZeroClipboard($copyBtn);clip.on("aftercopy",function(client,args){OKDialog("复制成功！")});clip.on("copy",function(e){e.clipboardData.setData("text/plain",txtObj.val().trim())});loadBDShareJS()}})})}else{ShareUrl="http://www.1yyg.com?s=shared";loadBDShareJS()}}catch(e){}var showBuyListFun=function(){var _BuyListObj=$("#div_UserBuyList");var callFun=function(result){var _Code=result.code;if(_Code==0){result=result.str;var _ListItems=result.listItems;var _maxLen=8;if(_ListItems.length>4&&_ListItems.length<8){_maxLen=4}else{if(_ListItems.length<=4){_maxLen=_ListItems.length}}var _html="";for(var i=0;i<_maxLen;i++){var _CodeState=_ListItems[i].codeState;var _newCodeID=_ListItems[i].newCodeID;var _index=i+1;var _Stock=0;if(_index%4==0){_html+='<div idx="'+_index+'" class="productsCon special'+(_newCodeID>0?"":" buy-end")+'">'}else{if(i%4==0){_html+='<div idx="'+_index+'" class="productsCon'+(_newCodeID>0?"":" buy-end")+'">'}else{_html+='<div idx="'+_index+'" class="productsCon'+(_newCodeID>0?"":" buy-end")+'">'}}_html+='<div class="proList">';_html+="<ul>";_html+='<li class="list-pic"><a target="_blank" href="http://www.1yyg.com/product/'+_ListItems[i].codeID+'.html">';_html+='<img src="http://skin.1yyg.net/images/loding.gif" src2="http://img.1yyg.net/goodspic/pic-200-200/'+_ListItems[i].goodsPic+'" />';if(_CodeState==2){_html+='<span class="g-bg"></span><span class="g-txt">正在揭晓</span>'}else{if(_CodeState==3){_html+='<span class="g-bg"></span><span class="g-txt">已揭晓</span>'}}_html+="</a></li>";_html+='<li class="list-name"><a target="_blank" href="http://www.1yyg.com/product/'+_ListItems[i].codeID+'.html">(第'+_ListItems[i].codePeriod+"云)"+_ListItems[i].goodsName+"</a></li>";if(_CodeState==1){_Stock=parseInt(_ListItems[i].codeQuantity)-parseInt(_ListItems[i].codeSales);var _Proportion=parseFloat(_ListItems[i].codeSales)/parseFloat(_ListItems[i].codeQuantity);var _BarLen=143*_Proportion;_BarLen=(_BarLen<1&&parseInt(_ListItems[i].codeSales)>0)?1:_BarLen;var _CanBuy=_Stock;if(_ListItems[i].codeType==3){_CanBuy=_ListItems[i].codeLimitBuy>=_Stock?_Stock:_ListItems[i].codeLimitBuy}_html+='<li class="g-progress">';_html+='<dl class="m-progress">';_html+='<dt><b style="width:'+_BarLen+'px;"></b></dt>';_html+="</dl>";_html+="</li>";_html+='<li class="gray9" style="display:none;">您已参与'+_ListItems[i].buyNum+"人次</li>";_html+='<li class="list-join" codeID="'+_ListItems[i].codeID+'" codeState="'+_CodeState+'" canBuy="'+_CanBuy+'"><a href="javascript:;">追加</a></li>'}else{if(_CodeState==2){if(_newCodeID>0){_html+='<li class="list-ing" style="display:;"><a target="_blank" href="http://www.1yyg.com/product/'+_newCodeID+'.html">第<em class="orange">'+_ListItems[i].newCodePeriod+"</em>云进行中…</a></li>";_html+='<li class="list-join" codeID="'+_newCodeID+'" codeState="'+_CodeState+'" ><a href="javascript:;">加入购物车</a></li>'}else{_html+='<li class="list-over"><a target="_blank" href="http://www.1yyg.com/product/'+_ListItems[i].codeID+'.html">已结束</a></li>'}}else{if(_newCodeID>0){_html+='<li class="list-ing" style="display:;"><a target="_blank" href="http://www.1yyg.com/product/'+_newCodeID+'.html">第<em class="orange">'+_ListItems[i].newCodePeriod+"</em>云进行中…</a></li>";_html+='<li class="list-join" codeID="'+_newCodeID+'" codeState="'+_CodeState+'" ><a href="javascript:;">加入购物车</a></li>'}else{_html+='<li class="list-over"><a target="_blank" href="http://www.1yyg.com/product/'+_ListItems[i].codeID+'.html">已结束</a></li>'}}}_html+="</ul>";if(_ListItems[i].codeType==3){_html+='<span class="F_goods_xg transparent-png">限购</span>'}_html+="</div>";_html+="</div>"}var _ItemObj=$(_html);_BuyListObj.siblings(".loading-2015").remove();_BuyListObj.append(_ItemObj);var _ListAdd;_ItemObj.parent().find("div.productsCon").hover(function(){var _This=$(this);if(_This.attr("idx")%4==0||_This.hasClass("special")){_This.addClass("products-hover products-hover2")}else{_This.addClass("products-hover")}_ListAdd=_This.find("li.list-join");if(_ListAdd.length>0){var _CodeState=_ListAdd.attr("codeState");if(_CodeState==1){_ListAdd.unbind("click").bind("click",function(){add2CartFun("添加成功！",$(this).attr("codeID"),$(this).attr("canBuy"))});_This.find("li.gray9").show();_This.find("li.g-progress").hide()}else{_ListAdd.unbind("click").bind("click",function(){add2CartFun("添加成功！",$(this).attr("codeID"))})}}},function(){var _This=$(this);if(_This.attr("idx")%4==0||_This.hasClass("special")){_This.removeClass("products-hover products-hover2")}else{_This.removeClass("products-hover")}if(_ListAdd.length>0){var _CodeState=_ListAdd.attr("codeState");if(_CodeState==1){_This.find("li.gray9").hide();_This.find("li.g-progress").show()}}});loadImgFun()}else{if(_Code==10){location.reload()}else{var html1='<img src="http://skin.1yyg.net/images/kt-yy.jpg"><p class="gray">主银，您最近还没有参与云购哦！ 梦想与您只有1元的距离~</p><a href="http://www.1yyg.com" class="z-kt-btn">立即参与</a>';_BuyListObj.parent().addClass("kt-icon").html(html1)}}};GetJPData("","getMemberCenterBuyMessage","FIdx=1&EIdx=20&state=-1&region=3m",callFun)};var showAttentionFun=function(){var _AttentObj=$("#div_AttentionList");var callFun=function(result){var _Code=result.code;if(_Code==0){var _ListItems=result.listItems;var _html="";for(var i=0;i<_ListItems.length;i++){var _IsSale=_ListItems[i].isSale;var _index=i+1;var _Stock=0;if(_index%4==0){_html+='<div idx="'+_index+'" class="productsCon special'+(_IsSale==1?"":" buy-end")+'">'}else{if(i%4==0){_html+='<div idx="'+_index+'" class="productsCon'+(_IsSale==1?"":" buy-end")+'">'}else{_html+='<div idx="'+_index+'" class="productsCon'+(_IsSale==1?"":" buy-end")+'">'}}_html+='<div class="proList">';_html+="<ul>";_html+='<li class="list-pic"><a target="_blank" href="http://www.1yyg.com/product/'+_ListItems[i].codeID+'.html">';_html+='<img src="http://skin.1yyg.net/images/loding.gif" src2="http://img.1yyg.net/goodspic/pic-200-200/'+_ListItems[i].goodsPic+'" /></a></li>';_html+='<li class="list-name"><a target="_blank" href="http://www.1yyg.com/product/'+_ListItems[i].codeID+'.html">'+_ListItems[i].goodsName+"</a></li>";if(_IsSale==1){_Stock=parseInt(_ListItems[i].quantity)-parseInt(_ListItems[i].sales);var _Proportion=parseFloat(_ListItems[i].sales)/parseFloat(_ListItems[i].quantity);var _BarLen=143*_Proportion;_BarLen=(_BarLen<1&&parseInt(_ListItems[i].sales)>0)?1:_BarLen;_html+='<li style="display:none;" class="g-progress">';_html+='<dl class="m-progress">';_html+='<dt><b style="width:'+_BarLen+'px;"></b></dt>';_html+="</dl>";_html+="</li>";_html+='<li style="display:none;" class="list-ing" codeID="'+_ListItems[i].codeID+'"><a href="javascript:;">加入购物车</a></li>';_html+='<li class="list-ing" ><a href="javascript:;">第<em class="orange">'+_ListItems[i].codePeriod+"</em>云进行中…</a></li>"}else{_html+='<li class="list-over"><a target="_blank" href="http://www.1yyg.com/product/'+_ListItems[i].codeID+'.html">已结束</a></li>'}_html+="</ul>";if(_ListItems[i].codeType==3){_html+='<span class="F_goods_xg transparent-png">限购</span>'}_html+="</div>";_html+="</div>"}var _ItemObj=$(_html);var _listIng;_ItemObj.parent().find("div.productsCon").hover(function(){var _This=$(this);if(_This.attr("idx")%4==0||_This.hasClass("special")){_This.addClass("products-hover products-hover2")}else{_This.addClass("products-hover")}if(_This.find(".list-ing").length>0){_listIng=_This.find("li:last");if(_listIng.length>0){_listIng.hide();_listIng.prev().prev().show();_listIng.prev().prev().prev().hide();_listIng.prev().unbind("click").bind("click",function(){add2CartFun("添加成功！",$(this).attr("codeID"))}).show()}}},function(){var _This=$(this);if(_This.attr("idx")%4==0||_This.hasClass("special")){_This.removeClass("products-hover products-hover2")}else{_This.removeClass("products-hover")}if(_This.find(".list-ing").length>0){if(_listIng.length>0){_listIng.show();_listIng.prev().hide();_listIng.prev().prev().hide();_listIng.prev().prev().prev().show()}}});_AttentObj.parent().siblings(".loading-2015").remove();_AttentObj.append(_ItemObj);loadImgFun();_AttentObj.jcarousel();_AttentObj.parent().parent().parent().show()}else{if(_Code==10){location.reload()}else{}}};GetJPData("","getCollectGoodsList","FIdx=1&EIdx=12",callFun)};var showPostListFun=function(){var _PostObj=$("#div_PostList");var loadPostImgFun=function(){var E="src2";var J=$("#loadingPicBlock");if(J.length>0){var G=J.find("img");var F=function(){return Math.max(document.documentElement.scrollTop,document.body.scrollTop)};var A=function(){return document.documentElement.clientHeight+F()+100};var D=F();var C=D;var B=function(){G.each(function(){if($(this).parent().offset().top<=A()){var H=$(this).attr(E);if(H){$(this).attr("src",H).removeAttr("style").removeAttr(E).show()}}})};$(window).bind("scroll",function(){C=F();if(C-D>50){D=C;B()}});B()}};var callFun=function(result){var _Code=result.code;if(_Code==0){var _ListItems=result.listItems;var _html="";for(var i=0;i<_ListItems.length;i++){var _class=(i+1)%3==0?"m-single m-single-special":"m-single";_html+='<div idx="'+(i+1)+'" class="'+_class+'">';_html+='<div class="single-list">';_html+="<ul>";_html+='<li class="sig-pic"><a target="_blank" href="http://post.1yyg.com/detail-'+_ListItems[i].postID+'.html">';_html+='<img style="margin: -27px auto 0;" src="http://skin.1yyg.net/images/loding.gif" src2="http://img.1yyg.net/UserPost/RecHome/'+_ListItems[i].cutpicture+'"></a></li>';_html+='<li class="sig-title"><a target="_blank" href="http://post.1yyg.com/detail-'+_ListItems[i].postID+'.html"><b>'+_ListItems[i].postTitle+"</b></a></li>";_html+='<li class="sig-text">'+_ListItems[i].postContent+"</li>";_html+="<li>"+_ListItems[i].postTime+"</li>";_html+='<li class="sig-xmjdh">';_html+='<a href="http://u.1yyg.com/'+_ListItems[i].userWeb+'">';_html+='<cite class="fl">';_html+='<img src="http://img.1yyg.net/UserFace/30/'+_ListItems[i].userPhoto+'"><s></s></cite>';_html+='<em class="fl">'+_ListItems[i].userName+"</em>";_html+="</a>";_html+='<b class="curr-arrow"><s class="u-personal"></s></b>';_html+="</li>";_html+="</ul>";_html+="</div>";_html+="</div>"}_PostObj.html(_html);loadPostImgFun();_PostObj.find("div.m-single").hover(function(){var _This=$(this);if(_This.attr("idx")%3==0){_This.addClass("single-hover single-hover2")}else{_This.addClass("single-hover")}},function(){var _This=$(this);if(_This.attr("idx")%3==0){_This.removeClass("single-hover single-hover2")}else{_This.removeClass("single-hover")}});_PostObj.parent().show()}};GetJPData("http://post.1yyg.com","GetPageListPostSingle","FIdx=1&EIdx=9",callFun)};showBuyListFun();showPostListFun();var _FriendMsgObj=$("#ul_friendmsg");var _FriendMsgLen=_FriendMsgObj.children("li").length;if(_FriendMsgLen>8){var Trundle=function(){var _lastobj=_FriendMsgObj.find("li:last");var _lastheight=76;_FriendMsgObj.prepend(_lastobj).css("marginTop","-"+_lastheight+"px");_FriendMsgObj.animate({marginTop:"0px"},1000)};var setTrundle=setInterval(Trundle,2000);_FriendMsgObj.hover(function(){clearInterval(setTrundle);setTrundle=null},function(){setTrundle=setInterval(Trundle,2000)})}else{_FriendMsgObj.parent().height((76*_FriendMsgLen-6)+"px")}};BindEvents()});function ColseMessage(b,a){EHad.off(b,a)}function closeDivTip(a){$("#"+a).hide()};
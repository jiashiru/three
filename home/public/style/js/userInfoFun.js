var _UserInfoCache=new Object();var _isExistUserCard=false;var _UserWebVal="";var isLoadCss=false;$.fn.ShowUserCard=function(){function n(z,y,w,x){$.getJSON(z+"/JPData?action="+y+"&"+w+"&fun=?",x)}var k="http://u.1yyg.com";var t=$(this);var g=t.attr("uweb");var b=false;var j=false;var v=null;var e=0;var p=0;t.hover(function(w){b=true;_UserWebVal=g;if(!j){j=true;setTimeout(a,500)}},function(){b=false;s()}).mousemove(function(w){e=t.offset().left+t.width();p=t.offset().top+t.height()/2});var c=function(w){if(w.pageX||w.pageY){return{x:w.pageX,y:w.pageY}}return{x:w.clientX+document.body.scrollLeft-document.body.clientLeft,y:w.clientY+document.body.scrollTop-document.body.clientTop}};var a=function(){var w=function(){if(_UserWebVal!=g||!b){return}if(_UserInfoCache["u"+g]!=null&&_UserInfoCache["u"+g]!="undefined"){r(_UserInfoCache["u"+g])}else{i()}};if(isLoadCss){w()}else{$.loadcss("http://skin.1yyg.net/css/user-info.css?v=150728",function(){w();isLoadCss=true})}};var i=function(){n(k,"getUserInfo","userWeb="+g,function(x){if(x.code==0){var w=x.sign.reAjaxStr();if(w==""){x.sign="这家伙忙着云购，还没写签名呢。"}else{x.sign=w}_UserInfoCache["u"+g]=x;r(x)}})};var o=function(x){var w='<em id="em_left" style="display:none;" class="left"><em></em></em><em id="em_right" style="display:none;" class="right"><em></em></em>';w+='<div class="u-show-con">';w+='<div class="u-pic">';w+='<a href="'+k+"/"+x.userWeb+'" target="_blank" title="'+x.userName+'">';w+='<img src="http://img.1yyg.net/UserFace/160/'+x.userPhoto+'" alt="" width="112" height="112">';w+="</a>";w+="</div>";w+='<div class="u-info">';w+='<a href="'+k+"/"+x.userWeb+'" target="_blank" rel="nofollow"  class="n-info-name">'+x.userName+"</a>";w+='<p class="grade class-icon'+x.grade+'">';w+="<s></s>";w+="<span>"+x.gradeName+"</span>";if(x.addr!=""){w+='<span class="u-info-address">'+x.addr+"</span>"}w+="</p>";w+='<p class="u-sign" title="'+x.sign+'">'+x.sign+"</p>";w+='<div class="u-send-add clearfix">';w+='<a href="javascript:void();" class="send-message" userName="'+x.userName+'"><i class="ng-box-bg"></i><span></span>发私信</a>';if(x.isFriend!=1){w+='<a href="javascript:void();" class="add-friend"><i class="ng-box-bg"></i>加好友</a>'}else{w+='<a href="javascript:void();" class="is-friend">已是好友</a>'}w+="</div>";w+="</div>";w+="</div>";return w};var r=function(A){if(!_isExistUserCard){$("body").append('<div id="divUserCard" class="u-show-protail"></div>');_isExistUserCard=true}v=$("#divUserCard");var z=o(A);v.html(z);var y=$("#em_left",v);var x=$("#em_right",v);v.unbind("mouseenter").unbind("mouseleave").hover(function(){b=true;j=true},function(){b=false;s()});v.find("a.add-friend").click(function(){d();n("http://api.1yyg.com","logininfo","",function(B){var C=B.code;if(C==1){m()}else{if(C==0){CBLPageFun.checkUserLoginFunEx(m)}}});return false});v.find("a.send-message").click(function(){d();var B=$(this).attr("userName");l="对 "+B+" 说：";n(k,"checkSendMsg","inceptUserWeb="+g,function(C){var D=C.code;if(D==10){CBLPageFun.checkUserLoginFunEx(q)}else{if(D==0){q()}else{if(D==1){if(C.num==-1){FailDialog("只有TA的好友才可以发私信给TA哦！",300)}else{if(C.num==-2){FailDialog("TA拒绝任何人发私信给TA哦！",240)}}}else{if(D==2){FailDialog("不能给自己发私信哦！",240)}else{FailDialog("发送失败，请重试！",240)}}}}});return false});var w=$(window).width();if(e+v.width()>w){e=e-v.width()-t.width()-10;y.hide();x.show()}else{e=e+10;y.show();x.hide()}v.css({left:e,top:p-v.height()/2,zIndex:1024}).show()};var f=function(){var w=0;if(typeof window.pageYOffset!=typeof undefined){w=window.pageYOffset}else{if(typeof document.compatMode!=typeof undefined&&document.compatMode!="BackCompat"){w=document.documentElement.scrollTop}else{if(typeof document.body!=typeof undefined){w=document.body.scrollTop}}}return w};var d=function(){b=false;j=false;$("#divUserCard").css({left:-300,top:-300}).html("").hide()};var s=function(){var w=function(){if(!b){j=false;$("#divUserCard").css({left:-300,top:-300}).html("").hide()}};setTimeout(w,200)};var m=function(){n(k,"applyFriend","userWeb="+g,function(x){var w=x.code;if(w==10){_IsLogin=false;CBLPageFun.checkUserLoginFunEx(m)}else{if(w==1){OKDialog("申请成功，请等待对方通过！",230)}else{if(w==2){FailDialog("TA已经是您的好友！")}else{if(w==3){FailDialog("不能加自己为好友！")}else{if(w==-1){FailDialog("对方拒绝加为好友！")}else{if(w==-2){FailDialog("您们已是好友关系！")}else{if(w==-4){FailDialog("您今天的好友申请已超出限数！")}else{FailDialog("申请失败，请重试！")}}}}}}}})};var h={action:"insertMsg",msgTouserWeb:g,msgContent:""};var l="";var u=function(w){if(h.msgContent==""){FailDialog("请输入私信内容！")}else{n(k,h.action,"msgTouserWeb="+h.msgTouserWeb+"&msgContent="+encodeURI(h.msgContent.replace("&"," ")),function(x){var y=x.code;if(y==10){location.reload()}else{if(y==1){w();OKDialog("发送成功！")}else{if(y==-1){FailDialog("只有TA的好友才可以发私信给TA哦！",300)}else{if(y==2){FailDialog("TA拒绝任何人发私信给TA哦！",220)}else{FailDialog("发送失败，请重试！")}}}}})}};var q=function(){var w=function(){var B=$("#txtPrivateMsgEx");var x=function(H,D,F,G){if(H.prev("iframe").length>0){return null}var E=$('<iframe class="edit-iframe" hidefocus="true" frameborder="0" scrolling="no" src="about:blank"></iframe>');E.css({width:H.width(),height:H.height()}).attr("src","http://info.1yyg.com/Editor/"+D+".htm?edit="+H.attr("id")+"&postdom="+G+(F==""?"":"&upurl="+F)+"");H.hide().before(E);E.ready(function(){});return E};var C=function(D){var E=x(D,"message","","btnPostMsgEx");this.GetHtml=function(){try{return E.get(0).contentWindow.GetHtml()}catch(F){return""}};this.remove=function(){E.remove();D.show()}};var y=function(){$.PageDialog.close()};var A=$('<input type="button" id="btnPostMsgEx" class="hidden" />');A.bind("click",function(){h.msgContent=z.GetHtml();u(y)});B.parent().append(A).show();var z=new C(B)};$.PageDialog('<textarea id="txtPrivateMsgEx" style="width:400px; height:160px; border:0px;"></textarea>',{title:l,W:410,H:200,ready:w})}};